# Extract Workflow System to swissarmyhammer-workflow Domain Crate

## Problem
swissarmyhammer-tools currently depends on workflow functionality from the main crate, creating coupling that prevents full domain separation.

## Current Dependencies
```rust
// This import should be ELIMINATED:
use swissarmyhammer::workflow::{...};

// Found in this specific location:
- src/mcp/server.rs:11
```

## Proposed Solution
Create `swissarmyhammer-workflow` domain crate and move workflow functionality there.

## Implementation Plan

### Phase 1: Create swissarmyhammer-workflow Crate
- [ ] Create new domain crate structure
- [ ] Move workflow functionality from main crate
- [ ] Set up dependencies on swissarmyhammer-templating (once available)

### Phase 2: Update swissarmyhammer-tools
- [ ] Add swissarmyhammer-workflow dependency
- [ ] Update imports from `swissarmyhammer::workflow` to `swissarmyhammer_workflow`
- [ ] Verify functionality still works

## COMPLETION CRITERIA - How to Know This Issue is REALLY Done

**This issue is complete when the following import NO LONGER EXISTS in swissarmyhammer-tools:**

```rust
// This import should be ELIMINATED:
use swissarmyhammer::workflow::{

// Found in this specific location:
- src/mcp/server.rs:11
```

**And replaced with:**
```rust
use swissarmyhammer_workflow::{...};
```

**Verification Command:**
```bash
# Should return ZERO results when done:
rg "use swissarmyhammer::workflow" swissarmyhammer-tools/

# Should find new imports:
rg "use swissarmyhammer_workflow" swissarmyhammer-tools/
```

**Expected Impact:**
- **Current**: 23 imports from main crate
- **After completion**: 22 imports from main crate (1 workflow import eliminated)

**Dependencies:**
- Requires swissarmyhammer-templating to be completed first
- May require error migration to be completed first

## Proposed Solution

After analyzing the workflow module, I found that the `swissarmyhammer-tools` crate currently imports 5 workflow types from the main crate:
- `FileSystemWorkflowRunStorage`
- `FileSystemWorkflowStorage` 
- `WorkflowRunStorageBackend`
- `WorkflowStorage`
- `WorkflowStorageBackend`

These are used in `swissarmyhammer-tools/src/mcp/server.rs` for MCP server workflow functionality.

The workflow module in the main crate is extensive (51 files) and contains:
- Core workflow types (State, Transition, WorkflowRun, etc.)
- Storage backends (FileSystem and Memory implementations)
- Executor logic for running workflows
- Actions system (Shell, Prompt, SubWorkflow, etc.)
- Parser for Mermaid state diagrams
- Visualization and metrics
- Agent integration (including LlamaAgentExecutor)

### Implementation Steps:

1. **Create `swissarmyhammer-workflow` domain crate** with proper dependencies on:
   - `swissarmyhammer-common` for error types
   - `swissarmyhammer-templating` for template functionality
   - Other necessary dependencies from workspace

2. **Move entire workflow module** from `swissarmyhammer/src/workflow/` to `swissarmyhammer-workflow/src/`
   - Preserve all 51 workflow files and their structure
   - Update internal imports to use new crate structure
   - Maintain all tests and functionality

3. **Update `swissarmyhammer-tools`** to depend on `swissarmyhammer-workflow` instead of main crate
   - Change import from `use swissarmyhammer::workflow::` to `use swissarmyhammer_workflow::`
   - Update Cargo.toml dependencies

4. **Update main crate** to re-export workflow types from the new domain crate
   - Keep backward compatibility for other consumers
   - Remove original workflow module after re-exports are in place

This approach ensures no breaking changes while achieving full domain separation.